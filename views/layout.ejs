<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Rajdhani:500,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="stylesheets/style.css" />
    <link rel="stylesheet" href="stylesheets/form.css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sender</title>
    <script>

        function getCookie(name) {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith(name))
                ?.split('=')[1];
            return cookieValue ? decodeURIComponent(cookieValue) : null;
        }

        $(document).ready(function () {
            const toastTrigger = document.getElementById('liveToastBtn')
            const toastLiveExample = document.getElementById('liveToast')
            if (toastTrigger) {
                toastTrigger.addEventListener('click', () => {
                    const toast = new bootstrap.Toast(toastLiveExample)

                    toast.show()
                })
            }

            let token = getCookie('token')
            if (token) {
                // window.location.href = '/home'
            }
        })
        function submitForm(e) {
            e.preventDefault()
            $('#loadingSpinner').show();
            const formData = {
                email: $('input[name="email"]').val(),
                password: $('input[name="password"]').val()
            };
            $.ajax({
                type: "POST",
                url: "/auth/login",
                data: JSON.stringify(formData),
                contentType: "application/json",
                success: function (response) {
                    $('#loadingSpinner').hide();
                    if (response?.isSuccess) {
                        localStorage.setItem("token", response?.token);
                        localStorage.setItem("userName", response?.userName);

                        document.cookie = `token=${response?.token}; path=/`;
                        document.cookie = `role=${response?.role}; path=/`;
                        showToast('successToast', response.message);
                        setTimeout(() => {
                            window.location.href = '/home'

                        }, 1000);
                    } else {
                        showToast('errorToast', 'Error in Login' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    $('#loadingSpinner').hide();
                    showToast('errorToast', 'Error in Login');
                }
            });
            // document.getElementById("myForm").submit();
        }
        function showToast(toastId, message) {
            const toastElement = $('#' + toastId);
            toastElement.find('.toast-body').text(message);
            const toast = new bootstrap.Toast(toastElement[0]);
            toast.show();
        }
    </script>
</head>

<body>
    <div class="loading" id="loadingSpinner" style="display: none;">
        <span class="typing-animation">Loading...</span>
    </div>
    <div class="container-fluid d-flex justify-content-center align-middle login-form">
        <div class="contact-wrapper" id="login-form">
            <header class="login-cta pb-3">
                <h2>Account Login</h2>
            </header>
            <form>
                <div class="form-row">
                    <input type="text" name="email" required>
                    <span>Username or Email</span>
                </div>
                <div class="form-row">
                    <input type="password" name="password" required>
                    <span>Password</span>
                </div>
                <div class="form-row"></div>
                <div class="form-row">
                    <button role="button" type="submit" onclick="submitForm(event)"
                        style="background-color: black;">Login to your Account!</button>
                </div>
            </form>
        </div>


        <!-- toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="successToast" class="toast success-toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header d-flex justify-content-end">
                    <strong class="me-auto">Success</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="successToastBody">
                    <!-- Success message will be inserted here -->
                </div>
            </div>

            <div id="errorToast" class="toast error-toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header d-flex justify-content-end">
                    <strong class="me-auto">Error</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="errorToastBody">
                    <!-- Error message will be inserted here -->
                </div>
            </div>
        </div>


    </div>
</body>

</html>