<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Rajdhani:500,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="stylesheets/style.css" />
    <link rel="stylesheet" href="stylesheets/form.css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sender</title>
    <script>

        function getCookie(name) {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith(name))
                ?.split('=')[1];
            return cookieValue ? decodeURIComponent(cookieValue) : null;
        }

        $(document).ready(function () {
            $(".select2").select2();
            const toastTrigger = document.getElementById('liveToastBtn')
            const toastLiveExample = document.getElementById('liveToast')
            if (toastTrigger) {
                toastTrigger.addEventListener('click', () => {
                    const toast = new bootstrap.Toast(toastLiveExample)

                    toast.show()
                })
            }

            let token = getCookie('token')
            if (token) {
                window.location.href = '/home'
            }
        })
        function submitForm(e) {
            e.preventDefault()
            $('#loadingSpinner').show();
            const formData = {
                email: $('input[name="email"]').val(),
                password: $('input[name="password"]').val()
            };
            $.ajax({
                type: "POST",
                url: "/auth/login",
                data: JSON.stringify(formData),
                contentType: "application/json",
                success: function (response) {
                    $('#loadingSpinner').hide();
                    if (response?.isSuccess) {
                        document.cookie = `token=${response?.token}; path=/`;
                        document.cookie = `userId=${response?.userId}; path=/`;
                        document.cookie = `role=${response?.role}; path=/`;
                        showToast('successToast', response.message);
                        window.location.href = '/home'
                    } else {
                        showToast('errorToast', 'Error in Login' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    $('#loadingSpinner').hide();
                    showToast('errorToast', 'Error in Login');
                }
            });
            document.getElementById("myForm").submit();
        }
        function showToast(toastId, message) {
            const toastElement = $('#' + toastId);
            toastElement.find('.toast-body').text(message);
            const toast = new bootstrap.Toast(toastElement[0]);
            toast.show();
        }
    </script>
</head>

<body>
    <div class="loading" id="loadingSpinner" style="display: none;">
        <span class="typing-animation">Loading...</span>
    </div>
    <div class="container-fluid d-flex justify-content-center align-middle">
        <div class="contact-wrapper" id="login-form">
            <header class="login-cta pb-3">
                <h2>Account Login</h2>
            </header>
            <form>
                <div class="form-row">
                    <input type="text" name="email" required>
                    <span>Username or Email</span>
                </div>
                <div class="form-row">
                    <input type="password" name="password" required>
                    <span>Password</span>
                </div>
                <div class="form-row"></div>
                <div class="form-row">
                    <button role="button" type="submit" onclick="submitForm(event)">Login to your Account!</button>
                </div>
            </form>
        </div>


        <!-- toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="successToast" class="toast success-toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header d-flex justify-content-end">
                    <strong class="me-auto">Success</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="successToastBody">
                    <!-- Success message will be inserted here -->
                </div>
            </div>

            <div id="errorToast" class="toast error-toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header d-flex justify-content-end">
                    <strong class="me-auto">Error</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="errorToastBody">
                    <!-- Error message will be inserted here -->
                </div>
            </div>
        </div>
        <!-- <div id="api-form">
            <form id="myForm" >
                <div>
                    <h1 class="mt-2 pt-5 mb-4">SMART App</h1>
                    <h2 class="mb-4">Authorization and Launch Context</h2>

                </div>
                <div class="my-2">
                    <label for="FHIRServer" class="form-label">API URL</label>
                    <input type="text" name="apiURL" class="form-control" id="FHIRServer" value="">
                </div>
                <div class="mb-2">
                    <label for="methods" class="form-label">Method</label>
                    <select class="select1 form-control " name="methods" id="methods">
                        <option value="" selected disabled>Select</option>
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PATCH">PATCH</option>


                    </select>
                </div>
                <div class="mb-2">
                    <label for="access_token" class="form-label">Body</label>
                    <textarea type="text" name="body" class="form-control" id="access_token" rows="4"></textarea>
                </div>
                <div class="mb-2">
                    <label for="scopes" class="form-label">Header</label>
                    <textarea type="text" name="header" class="form-control" id="id_token" rows="4"></textarea>
                </div>
                <div class="mb-2">
                    <label for="FHIRServer" class="form-label">Status code</label>
                    <div class="w-100">
                        <select class="select2 form-control" name="statusCode" id="FHIRServer-code" multiple>
                            <option value="200">200</option>
                            <option value="201">201</option>
                            <option value="400">400</option>
                            <option value="500">500</option>
                            <option value="203">203</option>
                            <option value="403">403</option>
                            <option value="504">504</option>

                        </select>

                    </div>
                </div>
                   
                <div class="mb-2">
                    <label for="patient" class="form-label">Time</label>
                    <input type="time" class="form-control" name="time" id="patients"  step="2">
                </div>
                <div class="mb-5">
                    <label for="patient" class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" id="patient" value="">
                </div>
                <div class="pb-3 pt-3 fixed-bottom d-flex bg-white shadow-lg ">
                    <div class="container">
                        <button type="submit" class="btn btn-primary ml-2 col-sm-4" style="background-color: black;"
                            href="https://launch.smarthealthit.org/?launch_url=" role="button"
                            onclick="submitForm(event)">SAVE</button>

                    </div>
                </div>
            </form>

        </div> -->
        <!-- <div id="table-form" style="display: none;">
            <%- include('table',{cronJob:cronJob}); -%>

        </div> -->

    </div>
</body>

</html>